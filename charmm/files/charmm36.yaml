# Conversion specification for CHARMM force field to OpenMM FFXML format.
# Author: Chaya D. Stern, choderalab
# Reworked by Evan Pretti to support the July 2024 release of CHARMM and provide
# clearer information on reasons why particular files are included vs. excluded.

- sourcePackage: charmm36
  sourcePackageVersion: toppar_c36_jul24.tgz
- Destination: charmm36_nowaters.xml
  Source:
    include:
     # Proteins (list first so that patches can be tested on amino acids first)
     - toppar/top_all36_prot.rtf
     - toppar/par_all36m_prot.prm

     # Nucleic acids
     - toppar/top_all36_na.rtf
     - toppar/par_all36_na.prm

     # Carbohydrates
     - toppar/top_all36_carb.rtf
     - toppar/par_all36_carb.prm

     # Lipids
     - toppar/top_all36_lipid.rtf
     - toppar/par_all36_lipid.prm

     # General molecules (list after protein, nucleic acid, and carbohydrate
     # parameters are loaded per note in top_all36_cgenff.rtf)
     - toppar/top_all36_cgenff.rtf
     - toppar/par_all36_cgenff.prm

    stream:
     - toppar/stream/prot/*.str
     - toppar/stream/na/*.str
     - toppar/stream/carb/*.str
     - toppar/stream/lipid/*.str
     - toppar/stream/misc/*.str

    exclude:
     # Only include the standard copies of these stream files
     # (toppar_all36_prot_heme.str and toppar_all36_na_rna_modified.str)
     - toppar/stream/prot/toppar_all36_prot_heme_for_new_psf_gen_code_2022.str
     - toppar/stream/na/toppar_all36_na_rna_modified_for_new_psf_gen_code_2022.str

     # The non-LJPME-optimized lipid parameters are included above, so exclude
     # these stream files that are for use with the LJPME-optimized parameters
     - toppar/stream/lipid/toppar_all36_lipid_bacterial_ljpme.str
     - toppar/stream/lipid/toppar_all36_lipid_ether_ljpme.str
     - toppar/stream/lipid/toppar_all36_lipid_miscellaneous_ljpme.str
     - toppar/stream/lipid/toppar_all36_lipid_yeast_ljpme.str

     # Model compounds are not included in the force field
     - toppar/stream/prot/toppar_all36_prot_model.str
     - toppar/stream/na/toppar_all36_na_model.str
     - toppar/stream/carb/toppar_all36_carb_model.str
     - toppar/stream/lipid/toppar_all36_lipid_model.str

     # Water and ions are split out elsewhere
     - toppar/stream/misc/toppar_ions_won.str

     # The reactive RNA stream file contains a patch entry for DMPR
     # (thio-substitution of DMPA: dimyristoyl-D-glycero-1-phosphatidic acid)
     # that causes conflicting atom types to be generated by ParmEd on account
     # of the identically named residue DMPR (dimethylpropanamide) defined by
     # CGenFF
     - toppar/stream/na/toppar_all36_na_reactive_rna.str

     # The glycolipid stream file contains values for CG2R61-CG301 (bond from
     # 6-membered aromatic ring carbon to aliphatic carbon with no hydrogens)
     # that are inconsistent with the CGenFF values
     - toppar/stream/carb/toppar_all36_carb_glycolipid.str

     # The following file includes other stream files that are already included
     - toppar/stream/lipid/toppar_all36_lipid_list.str

     # The following file is intended only for use during hydrogen bonding
     # analysis and it is incorrect to use it for normal simulation
     - toppar/stream/misc/toppar_hbond.str

    split:
     # D-amino acids are topologically equivalent to L-amino acids and make it
     # difficult to create protein systems in OpenMM; many of these as well as
     # topologically equivalent terminal patches are present in the modified
     # residue stream file
     - input:
       - toppar/stream/prot/toppar_all36_prot_c36m_d_aminoacids.str
       - toppar/stream/prot/toppar_all36_prot_modify_res.str
       output: charmm36_modified.xml

    fixes:
      # Here the CustomTorsionForce (used to handle impropers) is updated with a
      # correct functional form since ParmEd writes one that doesn't account for
      # the periodicity of theta
      - action: update_attrib
        target: ./CustomTorsionForce
        content:
          energy: k*min(dtheta, 2*pi - dtheta)^2; dtheta = abs(theta - theta0); pi = 3.1415926535897931

      # Here we manually add in the DISU (cysteine disulfide) patch to the force
      # field since ParmEd doesn't convert it automatically
      - action: append
        target: ./Patches
        content:
          tag: Patch
          attrib:
            name: DISU
            residues: '2'
          children:
            - tag: RemoveAtom
              attrib:
                name: 1:HG1
            - tag: RemoveAtom
              attrib:
                name: 2:HG1
            - tag: ChangeAtom
              attrib:
                charge: '-0.1'
                name: 1:CB
                type: DISU-1CB
            - tag: ChangeAtom
              attrib:
                charge: '-0.1'
                name: 2:CB
                type: DISU-2CB
            - tag: ChangeAtom
              attrib:
                charge: '-0.08'
                name: 1:SG
                type: DISU-1SG
            - tag: ChangeAtom
              attrib:
                charge: '-0.08'
                name: 2:SG
                type: DISU-2SG
            - tag: AddBond
              attrib:
                atomName1: 1:SG
                atomName2: 2:SG
            - tag: ApplyToResidue
              attrib:
                name: 1:CYS
            - tag: ApplyToResidue
              attrib:
                name: 2:CYS

  References:
   protein:
     - >-
       Huang, J., Rauscher, S., Nawrocki, G., Ran, T., Feig, M, de Groot, B.L., Grubmuller, H., and MacKerell, A.D.,
       Jr., "CHARMM36m: An Improved Force Field for Folded and Intrinsically Disordered Proteins," Nature Methods,
       14:71-73, 2016, PMC5199616
     - >-
       Robert B. Best, R.B., Xiao Zhu, X., Shim, J., Lopes, P. Mittal, J., Feig, M. and MacKerell, A.D., Jr. Optimization
       of the additive CHARMM all-atom protein force field targeting improved sampling of the backbone phi, psi and
       sidechain chi1 and chi2 dihedral angles. JCTC, 8: 3257-3273, 2013, PMC3549273
     - >-
       MacKerell, A.D., Jr., Feig, M. and Brooks, III, C.L. "Improved treatment of the protein backbone in empirical
       force fields," Journal of the American Chemical Society, 126: 698-699, 2004
     - >-
       MacKerell, Jr., A. D.; Bashford, D.; Bellott, M.; Dunbrack Jr., R.L.; Evanseck, J.D.; Field, M.J.; Fischer, S.;
       Gao, J.; Guo, H.; Ha, S.; Joseph-McCarthy, D.; Kuchnir, L.; Kuczera, K.; Lau, F.T.K.; Mattos, C.; Michnick, S.;
       Ngo, T.; Nguyen, D.T.; Prodhom, B.; Reiher, III, W.E.; Roux, B.; Schlenkrich, M.; Smith, J.C.; Stote, R.; Straub,
       J.; Watanabe, M.; Wiorkiewicz-Kuczera, J.; Yin, D.; Karplus, M.  All-atom empirical potential for molecular
       modeling and dynamics Studies of proteins.  Journal of Physical Chemistry B, 1998, 102, 3586-3616.
     - aldehydes:
       - >-
         Wymore, T., Hempel, J., Cho, S.S., MacKerell, Jr., A.D. Nicholas, Jr., H.B., Deerfield, II, D.W.  Molecular 
         Recognition of Aldehydes by Aldehyde Dehydrogenase and Mechanism of Nucleophile Activation, Submitted for
         publication.
     - arginine:
       - >-
         Li, L., Vorobyov, I.V., MacKerell, Jr., A.D., Allen, T.W., "Is arginine charged in a membrane?" Biophysical
         Journal, 94: L11-L13, 2008, PMCID: PMC2157258
     - cofactors:
       - >-
         Aleksandrov A. A Molecular Mechanics Model for Flavins, Journal of Computational Chemistry, 2019,
         40(32):2834-2842, doi: 10.1002/jcc.26061
       - >-
         Balduzzi et al. Additive CHARMM Force Field for Pterins and Folates, 2024, submitted
       - >-
         Poleto et al. Structural Dynamics of the Methyl-Coenzyme M Reductase Active Site Are Influenced by Coenzyme
         F430 Modifications, Biochemistry 2024, 63, 14, 1783–1794, https://doi.org/10.1021/acs.biochem.4c00168.
     - fluoroalkanes:
       - >-
         Chen, I.-J., Yin, D. and MacKerell, Jr., A.D., "Combined Ab initio/Empirical Approach for Optimization of
         Lennard-Jones Parameters for Polar-Neutral Compounds," Journal of Computational Chemistry, 2002, 23:199-213.
     - modified:
       - >-
         Croitoru, A., Park, S.-J., Kumar, A., Lee, J., Im, Wonpil; MacKerell, A.D., Jr., and Aleksandrov, A.
         Additive CHARMM36 Force Field for Nonstandard Amino Acids, Journal of Chemical Theory and Computation,
         17:3554-3570, doi: 10.1021/acs.jctc.1c00254.
     - phosphotyrosine:
       - >-
         Feng, M.-H., Philippopoulos, M., MacKerell, Jr., A.D. and Lim, C. Structural Characterization of the
         Phosphotyrosine Binding Region of a High-Affinity aSH2 Domain-Phosphopeptide Complex by Molecular Dynamics
         Simulation and Chemical Shift Calculations. Journal of the American Chemical Society, 1996, 118: 11265-11277.
     - pyridines:
       - >-
         Yin, D., Ph.D. Thesis, "Parameterization for Empirical Force Field Calculations and A Theoretical Study of
         Membrane Permeability of Pyridine Derivative," Department of Pharmaceutical Sciences, School of Pharmacy,
         University of Maryland, 1997
   nucleic acids:
     - >-
       Denning, E.J., Priyakumar, U.D., Nilsson, L., and MacKerell Jr., A.D., "Impact of 2'-hydroxyl sampling on the
       conformational properties of RNA: Update of the CHARMM all-atom additive force field for RNA," JCC, 32:
       1929-1943, 2011, PMC3082605
     - >-
       Hart, K. Foloppe, N., Baker, C.M, Denning, E.J., Nilsson, L. and MacKerell Jr., A.D. "Optimization of the CHARMM
       additive force field for DNA: Improved of the BI/BII conformational equilibrium," JCTC, 8:348-362, 2012,
       PMC3285246
     - >-
       Foloppe, N. and MacKerell, Jr., A.D. "All-Atom Empirical Force Field for Nucleic Acids: 1) Parameter Optimization
       Based on Small Molecule and Condensed Phase Macromolecular Target Data." JCC, 2000, 21: 86-104.
     - >-
       MacKerell, Jr., A.D. and Banavali, N. "All-Atom Empirical Force Field for Nucleic Acids: 2) Application to
       Molecular Dynamics Simulations of DNA and RNA in Solution." JCC, 2000, 21: 105-120.
     - modified:
       - >-
         Wang, P., Nicklaus, M.C., Marquez, V.E., Brank, A.S., Christman, J., Banavali, N.K. and MacKerell, Jr.,
         A.D., "Use of Oligodeoxyribonucleotides with Conformationally Constrained Abasic Sugar Targets to Probe the
         Mechanism of Base Flipping by HhaI DNA (Cytosine C5)-Methyltransferase" Journal of the American Chemical
         Society, 2000, 122:12422-12434
       - >-
         Hartono, YD; Xu, Y; Karshikoff, A; Nilsson, L; Villa, A "Modeling pKa Shift in DNA Triplexes Containing Locked
         Nucleic Acids" J Chem Inf Model, 58:773-783. 2018 doi: 10.1021/acs.jcim.7b00741
       - >-
         Jasinski, M., Feig, M., & Trylska, J. "Improved Force Fields for Peptide Nucleic Acids with Optimized Backbone
         Torsion  Parameters" J.Chem.Theory Comput., 14: 3603–3620, 2018, doi: 10.1021/acs.jctc.8b00291
       - >-
         Xu, Y., Vanommeslaeghe, K., Aleksandrov, A., MacKerell, A.D., Jr. Nilsson, L., "Additive CHARMM force field
         for naturally occurring modified ribonucleotides," Journal of Computational Chemistry, DOI: 10.1002/jcc.24307, 2016
     - atp adp nad+ nadh ppi:
        - >-
          Pavelites, J.J., Bash, P.A., Gao, J., and MacKerell, Jr., A.D. A Molecular Mechanics Force Field for NAD+,
          NADH and the Pyrophosphate Groups of Nucleotides, Journal of Computational Chemistry, 1997, 18: 221-239.
   carbohydrates:
     - pyranose monosaccharides:
       - >-
         Guvench, O., Greene, S.N., Kamath, G., Brady, J.W., Venable, R.M., Pastor, R.W., MacKerell, Jr., A.D.
         "Additive empirical force field for hexopyranose monosaccharides," Journal of Computational Chemistry, 29:
         2543-2564, 2008. PMID: 18470966
     - linear sugars inositol sugar alcohols:
       - >-
         Hatcher, E., Guvench, O., and MacKerell, Jr., A.D., "CHARMM Additive All-Atom Force Field for Acyclic
         Polyalcohols, Acyclic Carbohydrates and Inositol," Journal of Chemical Theory and Computation, 5: 1315-1327,
         2009, DOI: 10.1021/ct9000608.
     - hexopyranose glycosidic linkages:
       - >-
         Guvench, O., Hatcher, E. R., Venable, R. M., Pastor, R. W., MacKerell, Jr., A. D. "Additive Empirical CHARMM
         Force Field for glycosyl linked hexopyranoses," Journal of Chemical Theory and Computation, 5, 2353-2370, 2009,
         DOI: 10.1021/ct900242e
     - furanose monosaccharides:
       - >-
         Hatcher, E. R.; Guvench, O. and MacKerell, Jr., A.D. "CHARMM Additive All-Atom Force Field for
         Aldopentofuranose Carbohydrates and Fructofuranose." Journal of Physical Chemistry B. 113:12466-76, 2009,
         PMID: 19694450
     - glycosidic linkages involving furanoses:
       - >-
         Raman, E. P., Guvench, O., MacKerell, Jr., A.D., "CHARMM Additive All-Atom Force Field for Glycosidic Linkages
         in Carbohydrates Involving Furanoses," Journal of Physical Chemistry B, 114: 12981-12994, 2010, PMID: 20845956
     - carbohydrate derivatives and glycosidic linkages for glycoproteins:
       - >-
         Guvench, O.; Mallajosyula, S. S.; Raman, E. P.; Hatcher, E. R.; Vanommeslaeghe, K.; Foster, T. J.; Jamison,
         F. W. and MacKerell, Jr., A.D., "CHARMM additive all-atom force field for carbohydrate derivatives and its
         utility in polysaccharide and carbohydrate-protein modeling," Journal of Chemical Theory and Computation 2011
         7 (10), 3162-3180
     - O-glycan linkages:
       - >-
         Mallajosyula, S. S. and MacKerell, Jr., A.D., "Influence of Solvent and Intramolecular Hydrogen Bonding on the
         Conformational Properties of O-Linked Glycopeptides," The Journal of Physical Chemistry B 2011 115 (38),
         11215-11229.
     - phosphates and sulfates:
       - >-
         Mallajosyula, S. S.; Guvench, O; Hatcher E. R. and MacKerell, Jr., A.D., "CHARMM Additive All-Atom Force Field
         for Phosphate and Sulfate Linked to Carbohydrates" Journal of Chemical Theory and Computation 2012 8 (2),
         759-776.
     - lignin:
       - >-
         Vermaas et al., "Systematic parameterization of lignin for the CHARMM force field, " Green Chemistry 21: 109,
         2019, DOI: 10.1039/c8gc03209b
       - >-
         Vermaas et al., "Automated Transformation of Lignin Topologies into Atomic Structures with LigninBuilder,"
         ACS Sustainable Chem. Eng. 7:3443, 2019, DOI: 10.1021/acssuschemeng.8b05665
   lipids:
     - >-
       Jeffery B. Klauda, Richard M. Venable, J. Alfredo Freites, Joseph W. O'Connor, Douglas J. Tobias, Carlos
       Mondragon-Ramirez, Igor Vorobyov, Alexander D. MacKerell, Jr. and Richard W. Pastor "Update of the CHARMM
       All-Atom Additive Force Field for Lipids: Validation on Six Lipid Types" J. Phys. Chem. B 2010, 114, 7830-7843
     - PUFA modifications:
       - >-
         Jeffery B. Klauda, Viviana Monje, Taehoon Kim, and Wonpil Im. "Improving the CHARMM Force Field for
         Polyunsaturated Fatty Acid Chains" J. Phys. Chem. B. 2012 ASAP http://dx.doi.org/10.1021/jp304056p
     - atom nomenclature:
       - >-
         Sundaralingan, M., Ann. N.Y. Acad. Sci. USA, 195:324-355, 1972
     - bacterial:
       - >-
         Lim, J.B. and Klauda, J.B. Branching at the Iso- and Anteiso- Positions in Complex Chlamydia Membranes: A
         Molecular Dynamics Study. Biochimica et Biophysica Acta (BBA) - Biomembranes 1808:323-331 (2011).
       - >-
         Pandit, K.R. and Klauda, J.B. Membrane models of E. coli containing cyclic moieties in the aliphatic lipid
         chain. Biochimica et Biophysica Acta (BBA) - Biomembranes 1818:1205-1210 (2012).
     - cation-pi:
       - >-
         Khan, MacKerell, Jr., and Reuter, "Cation-π Interactions between Methylated Ammonium Groups and
         Tryptophan in the CHARMM36 Additive Force Field," J. Chem. Theory Comput. 2019, 15, 1, 7-12, DOI:
         10.1021/acs.jctc.8b00839
     - cholesterol:
       - >-
         Lim, J.B., Rogaski, B. and Klauda, J.B.. "Update of the Cholesterol Force Field Parameters in CHARMM" 116:
         203-210 (2012).
       - >-
         Suits, F., Pitman, M., MacKerell, A.D., Jr., Feller, S.E. "Molecular Level Organization of Saturated and
         Polyunsaturated Fatty Acids in a Phosphatidylcholine Bilayer Containing Cholesterol" Biochemistry, 43(49):
         15318-28, 2004
     - sphingomyelin:
       - >-
         Venable, R.M., B. Rogaski, H. Rui, A.D. MacKerell, Jr., R.W. Pastor, and J.B. Klauda. An Experimentally Validated
         All-atom Force Field for Sphingomyelin. In prep. (2013).
   cgenff:
     - >-
       K. Vanommeslaeghe, E. Hatcher, C. Acharya, S. Kundu, S. Zhong, J. Shim, E. Darian, O. Guvench, P. Lopes, I.
       Vorobyov and A. D. Mackerell Jr., J. Comput. Chem. 2010, 31, 671-690.
     - >-
       W. Yu, X. He, K. Vanommeslaeghe, A. D. MacKerell Jr., J. Comput. Chem. 2012, 33, 2451-2468.
   amines:
     - >-
       Chen, I.-J., Yin, D. and MacKerell, Jr., A.D., "Combined Ab initio/Empirical Approach for Optimization of
       Lennard-Jones Parameters for Polar-Neutral Compounds," Journal of Computational Chemistry, 2002, 23:199-213.
